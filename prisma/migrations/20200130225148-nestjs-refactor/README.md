# Migration `20200130225148-nestjs-refactor`

This migration has been generated by William Sedlacek at 1/30/2020, 10:51:48 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Admin" (
    "email" text  NOT NULL DEFAULT '',
    "id" SERIAL,
    "password" text  NOT NULL DEFAULT '',
    "role" text  NOT NULL DEFAULT 'ADMIN',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Parent" (
    "email" text  NOT NULL DEFAULT '',
    "id" SERIAL,
    "password" text  NOT NULL DEFAULT '',
    "stripeID" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Cohort" (
    "activity" text  NOT NULL DEFAULT '',
    "id" SERIAL,
    "name" text  NOT NULL DEFAULT '',
    "week" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."DueDates" (
    "cohort" integer   ,
    "id" SERIAL,
    "reading" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "submission" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Child" (
    "cohort" integer  NOT NULL ,
    "grade" integer  NOT NULL DEFAULT 0,
    "id" SERIAL,
    "parent" integer  NOT NULL ,
    "preferences" integer  NOT NULL ,
    "subscription" boolean  NOT NULL DEFAULT false,
    "username" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Preferences" (
    "dyslexia" boolean  NOT NULL DEFAULT false,
    "id" SERIAL,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Progress" (
    "child" integer   ,
    "id" SERIAL,
    "reading" boolean  NOT NULL DEFAULT false,
    "submission" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Submission" (
    "child" integer  NOT NULL ,
    "id" SERIAL,
    "illustration" text   ,
    "story" text   ,
    "storyText" text   ,
    "week" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Canon" (
    "altbase64" text   ,
    "base64" text  NOT NULL DEFAULT '',
    "week" integer  NOT NULL ,
    PRIMARY KEY ("week")
) 

CREATE UNIQUE INDEX "Admin.email" ON "public"."Admin"("email")

CREATE UNIQUE INDEX "Parent.email" ON "public"."Parent"("email")

CREATE UNIQUE INDEX "Parent.stripeID" ON "public"."Parent"("stripeID")

CREATE UNIQUE INDEX "Cohort.name" ON "public"."Cohort"("name")

CREATE UNIQUE INDEX "Child_preferences" ON "public"."Child"("preferences")

ALTER TABLE "public"."DueDates" ADD FOREIGN KEY ("cohort") REFERENCES "public"."Cohort"("id") ON DELETE SET NULL

ALTER TABLE "public"."Child" ADD FOREIGN KEY ("parent") REFERENCES "public"."Parent"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Child" ADD FOREIGN KEY ("cohort") REFERENCES "public"."Cohort"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Child" ADD FOREIGN KEY ("preferences") REFERENCES "public"."Preferences"("id") ON DELETE RESTRICT

ALTER TABLE "public"."Progress" ADD FOREIGN KEY ("child") REFERENCES "public"."Child"("id") ON DELETE SET NULL

ALTER TABLE "public"."Submission" ADD FOREIGN KEY ("child") REFERENCES "public"."Child"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200130225148-nestjs-refactor
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,83 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+enum AdminRole {
+  ADMIN
+  MODERATOR
+}
+
+model Admin {
+  id        Int        @id      @default(autoincrement())
+  email     String     @unique
+  password  String
+  role      AdminRole
+}
+
+model Parent {
+  id        Int      @id      @default(autoincrement())
+  email     String   @unique
+  password  String
+  stripeID  String   @unique
+  children  Child[]
+}
+
+model Cohort {
+  id        Int         @id      @default(autoincrement())
+  name      String      @unique
+  activity  String
+  dueDates  DueDates[]
+  week      Int
+  children  Child[]
+}
+
+model DueDates {
+  id          Int       @id  @default(autoincrement())
+  reading     DateTime       @default(now())
+  submission  DateTime       @default(now())
+}
+
+
+model Child {
+  id             Int           @id  @default(autoincrement())
+  subscription   Boolean            @default(false)
+  username       String
+  grade          Int
+  preferences    Preferences
+  cohort         Cohort
+  parent         Parent
+  submissions    Submission[]
+  progress       Progress[]
+}
+
+model  Preferences {
+  id        Int      @id  @default(autoincrement())
+  child     Child
+  dyslexia  Boolean       @default(false)
+}
+
+model Progress {
+  id          Int      @id  @default(autoincrement())
+  reading     Boolean       @default(false)
+  submission  Boolean       @default(false)
+}
+
+model Submission {
+  id            Int      @id  @default(autoincrement())
+  week          Int
+  child         Child
+  illustration  String?
+  story         String?
+  storyText     String?
+}
+
+model Canon {
+  week       Int      @id
+  base64     String
+  altbase64  String?
+}
```


